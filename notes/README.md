# Helpful tips and code

## Certificates

For working in a **dev** environment that needs both creating a root certificate authority and self-signed certificate using OpenSSL in Powershell. Download OpenSSL (get via chocolatey)

1. Create the private key for the root certificate authority
1. Create the root certificate based on this private key
1. Create a private key for the self-signed certifiate
1. Create the signing request (must fill in the **common name** field)
1. Greate the certificate with the root cert and key
1. package both the private keys and certs in encrypted p12 files

NB: when using the below code, the common name for the root authority and the cert being signed by the root authority should not be the same

```
openssl genrsa -des3 -out rootCA.key 4096
openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.crt

openssl genrsa -out domainCert.key 2048
openssl req -new -key domainCert.key -out domainCert.csr
openssl x509 -req -in domainCert.csr -CA rootCA.crt -CAkey rootCA.key -out domainCert.crt -days 1024 -sha256

openssl pkcs12 -export -out rootCA.p12 -inkey rootCA.key -in rootCA.crt
openssl pkcs12 -export -out domainCert.p12 -inkey domainCert.key -in domainCert.crt
```

## Git

Useful commands:
* `git rebase -i` to edit / squash commits
* `git branch -d <branch>` to delete a local branch
* `git push --set-upstream origin <branch name>` to set upstream branch once branch created
* `git remote prune origin --dry-run` (remove `--dry-run` to action) remove reference to remote if branch no longer exists on the remote
* `git fetch --prune` remove any remote-tracking references that no longer exist on the remote
* `git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD)` get the current remote tracking branch
 

Accidentally started working on something whilst on the master branch? (workflow below not using stash)

1. checkout and switch to a feature branch
1. commit the changes in the feature branch
1. switch back to master
1. pull from remote to get the latest version
1. switch to the feature branch
1. merge master into the feature branch
1. continue working on the feature branch

[Github Blog](https://blog.github.com/)
[Atlassian Git Tutorial](https://www.atlassian.com/git/tutorials)
[Github Blog on Undo](https://blog.github.com/2015-06-08-how-to-undo-almost-anything-with-git/)


## IIS (Internet Information Services)

This is very useful in order to create a web server / website hosted locally 

1. Start IIS Manager with `inetmgr`
1. Add a website
1. Add site name and host and path to physical file
1. Set bindings to 127.0.0.1
1. Running a local static site:
    * .NET CLR version: No Managed Code
    * Managed Pipeline mode: Classic
    * Advanced Settings (Identity): LocalSystem
1. Running a networked .NET site:
    * .NET CLR version: .NET CLR v4.0
    * Managed Pipeline mode: Integrated
    * Advanced Settings (Identity): NetworkService   
1. Update the hosts file (C:\Windows\System32\drivers\etc) to include the IP address and host domain

## Javascript

[You Don't Know Series](https://github.com/getify/You-Dont-Know-JS)

## Markdown

[Markdown Cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#links)

## Powershell

[Microsoft Docs](https://docs.microsoft.com/en-us/powershell/scripting/powershell-scripting?view=powershell-6)

## Sitecore

[Official Docs](http://learnsitecore.cmsuniverse.net/en/globalnavigation/sitecore-beginners-guide.aspx)

## Vim

Helpful when editing git commits in the terminal
* `i` to insert (edit)
* ```Ctrl + V``` to select the whole line
* ```d``` to yank (cut) the line
* ```:wq``` to save and exit

## Browsermob and Selenium
See Browsermob: https://github.com/lightbody/browsermob-proxy

Using Browsermob with Selenium when testing in IE. When testing in IE, a self-signed root certificate is required in order to capture https requests. This is not required in Chrome or Firefox. Browsermob provides the root certificates here: https://github.com/lightbody/browsermob-proxy/tree/master/browsermob-core/src/main/resources/sslSupport. They include four files:
* ca-certificate-ec.cer (ignore - cert generated with Elliptic Curve Cryptography, an alternative to RSA)
* ca-keystore-ec.p12 (ignore - as above)
* ca-certificate-rsa.cer (the required certificate **required**)
* ca-keystore-rsa.p12 (encrypted container containing the private key and certificate **required**)

In order to use a custom generated root certificate instead of the one generated by Browsermob, 
* follow the instructions at https://github.com/lightbody/browsermob-proxy/blob/master/mitm/README.md#improving-performance-with-elliptic-curve-ec-cryptography (Java) or
* generate your own `.cer` and `.p12` files and replace the ones created by Browsermob (requires a bit of manual modification as the certificates are in three locations)

### Custom Root Certificate
Create the `.cer` and `.p12` files with the following commands:
```
openssl genrsa -des3 -out ie-rCA.key 4096
openssl req -x509 -new -nodes -key ie-rCA.key -sha256 -days 3650 -out ca-certificate-rsa.cer
openssl pkcs12 -export -out ca-keystore-rsa.p12 -inkey ie-rCA.key -in ca-certificate-rsa.cer -certfile ca-certificate-rsa.cer -name key
```
* `-des3`: encrypt the generated key with DES in ede cbc mode (168 bit key)
* `4096`: The number of bits in the generated key
* `-x509`: output a x509 structure instead of a cert. req.
* `-nodes`: don't encrypt the output key
* `-sha256`: use the sha256 message digest algorithm
* `pkcs12`: contains a x509 Certificate and the public/private key of client
* `-name`: use name as friendly name

Notes:
* the export password for creating the p12 file must be `password` as this is what the proxy server expects (it extracts the cert and private key from the p12 file to check it matches - ??)
* when generating the certificate, the `Common Name` field must be completed (enter something)
* the final files must be the same as the default Browsermob files as the code inside Browsermob searches for specific named files

### Replace existing files 
Once the two custom files are generated, replace the existing files in the following locations:
1. `/ssl-support`
1. `/browsermob-core-2.1.2-sources.jar` --> extract and replace in `/sslSupport` folder
1. `/lib/browsermob-dist-2.1.2.jar` --> extract and replace in `/sslSupport` folder
Need to unzip, replace and then re-zip the files (any zip program, just output to `.jar`)

### Import the certificate
Import the certificate into Trusted Root Certification Authorities.
